# ============================================================
# AI Receptionist — Backend Environment Configuration
# ============================================================
# Copy this file to .env and fill in your values.
# NEVER commit .env to version control.
# ============================================================

# --- Server ---
PORT=3000
HOST=0.0.0.0
NODE_ENV=development
LOG_LEVEL=info

# --- Database ---
DATABASE_URL=postgresql://receptionist:receptionist_dev@localhost:5432/receptionist

# --- OpenAI-compatible API ---
OPENAI_API_KEY=your-openai-api-key
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o

# --- Google OAuth (optional — leave blank to skip calendar) ---
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=http://localhost:3000/api/oauth/google/callback

# --- Calendar Mode ---
# mock = no external calendar API calls (local dev, DB-only scheduling)
# real = live Google Calendar integration (requires OAuth credentials above)
CALENDAR_MODE=mock

# --- Calendar Failure Simulation (mock mode only) ---
# Simulates external calendar failures for testing error handling.
# none          = normal mock behavior (default)
# auth_error    = createEvent throws 401 Invalid Credentials
# network_error = createEvent throws ECONNREFUSED
# timeout       = createEvent waits 5s then throws ETIMEDOUT
# all_ops_fail  = both createEvent AND deleteEvent throw
CALENDAR_FAIL_MODE=none

# --- Calendar Sync Required ---
# When true: booking is rolled back if calendar sync fails.
# When false (default): calendar sync is best-effort.
CALENDAR_SYNC_REQUIRED=false

# --- Demo Availability Mode ---
# When true AND CALENDAR_MODE=mock: injects Mon-Fri 9 AM – 5 PM ET
# business hours so GUI testing works any day (including weekends).
# Disable for production or when using a real calendar.
DEMO_AVAILABILITY=true

# --- Demo Tenant Drift Guard ---
# When true (default) and NODE_ENV != production: on boot, auto-corrects
# the demo tenant row to match expected repo defaults (name, slug, etc.).
# Prevents stale seed data from reintroducing old branding.
DEMO_TENANT_DRIFT_GUARD=true

# --- Security ---
ENCRYPTION_KEY=dev-only-placeholder-key-0000000000
CORS_ORIGIN=http://localhost:5173

# --- CORS Lockdown (pilot / production) ---
# PILOT_MODE=true activates strict CORS without requiring NODE_ENV=production.
# Only origins in CORS_ALLOWED_ORIGINS are allowed when strict mode is active.
# In dev mode (default), all localhost origins are allowed automatically.
#
# Example for a friendly pilot deployment:
#   PILOT_MODE=true
#   CORS_ALLOWED_ORIGINS=https://pilot.gomomo-demo.com,https://admin.gomomo-demo.com
#   CORS_ALLOW_CREDENTIALS=true
PILOT_MODE=false
CORS_ALLOWED_ORIGINS=
CORS_ALLOW_CREDENTIALS=true

# --- HTTPS Enforcement ---
# When true: rejects plain HTTP requests with 403 (except /health).
# Requires a reverse proxy (nginx/caddy) that sets X-Forwarded-Proto.
# Keep false for local dev / DEMO-FULL.
REQUIRE_HTTPS=false

# --- Hold TTL ---
HOLD_TTL_MINUTES=5
HOLD_CLEANUP_INTERVAL_MS=60000

# --- Twilio (optional — leave blank to skip voice/SMS) ---
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=
TWILIO_WEBHOOK_BASE_URL=http://localhost:3000

# --- Feature Flags (master kill switches) ---
# FEATURE_VOICE_WEB: browser push-to-talk STT + neural TTS.
# When true, POST /api/stt and POST /api/tts are available,
# the widget shows a mic button and uses neural speech.
FEATURE_VOICE_WEB=false

# --- Web Voice Mode (TTS) ---
# Neural TTS voice: alloy, ash, coral, echo, fable, nova, onyx, sage, shimmer
TTS_VOICE=nova
# TTS model: tts-1 (fast) or tts-1-hd (higher quality)
TTS_MODEL=tts-1

# --- Voice Channel ---
VOICE_ENABLED=false
VOICE_DEFAULT_TENANT_ID=00000000-0000-4000-a000-000000000001
VOICE_MAX_CALL_DURATION_MS=600000
VOICE_MAX_TURNS=20
VOICE_MAX_RETRIES=3
VOICE_TTS_VOICE=Polly.Joanna
VOICE_TTS_LANGUAGE=en-US
VOICE_SPEECH_TIMEOUT=auto
VOICE_SPEECH_MODEL=phone_call

# --- SMS Handoff ---
SMS_HANDOFF_ENABLED=false
SMS_HANDOFF_WEB_URL=http://localhost:5173
SMS_HANDOFF_TOKEN_TTL_MINUTES=15
SMS_RATE_LIMIT_MAX=3
SMS_RATE_LIMIT_WINDOW_MINUTES=60

# --- Excel Integration ---
EXCEL_ENABLED=false
EXCEL_DEFAULT_FILE_PATH=
EXCEL_SYNC_INTERVAL_SECONDS=30
EXCEL_RECONCILIATION_INTERVAL_MS=300000

# --- Autonomous Agent Runtime ---
# Master switch. When false, events are still logged and the audit
# trail works, but the job runner does NOT poll or execute jobs.
# Set to true to activate autonomous behaviors (policy-gated).
AUTONOMY_ENABLED=false
AGENT_MAX_CONCURRENT_JOBS=3
AGENT_JOB_POLL_INTERVAL_MS=5000
AGENT_JOB_STALE_TIMEOUT_MS=300000

# --- reCAPTCHA v3 Spam Protection ---
# Master switch. When false (default), all captcha checks are skipped —
# zero impact on existing dev workflows.
# When true, booking-intake and email-verification requests must include
# a valid reCAPTCHA v3 token from the frontend.
RECAPTCHA_ENABLED=false
RECAPTCHA_SITE_KEY=
RECAPTCHA_SECRET_KEY=
# Score threshold (0.0 = bot, 1.0 = human). Requests below this score
# are rejected. Default 0.5 — tune per traffic pattern.
RECAPTCHA_MIN_SCORE=0.5
